<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Habit Tracker | NEXUS</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js (–¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞ –∫–∞–∫ –Ω–∞ –≤–∏–¥–µ–æ) -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* === –û–°–ù–û–í–ù–û–ô –î–ò–ó–ê–ô–ù === */
        body {
            background-color: #0f172a;
            background-image: 
                radial-gradient(at 0% 0%, hsla(253,16%,7%,1) 0, transparent 50%), 
                radial-gradient(at 50% 0%, hsla(225,39%,30%,1) 0, transparent 50%), 
                radial-gradient(at 100% 0%, hsla(339,49%,30%,1) 0, transparent 50%);
            background-size: cover;
            background-attachment: fixed;
            color: #e2e8f0;
            font-family: 'Segoe UI', Roboto, sans-serif;
        }

        /* –≠—Ñ—Ñ–µ–∫—Ç —Å—Ç–µ–∫–ª–∞ */
        .glass {
            background: rgba(30, 41, 59, 0.4);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        /* === –¢–ê–ë–õ–ò–¶–ê –ò –°–ö–†–û–õ–õ === */
        .table-container {
            overflow-x: auto; /* –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π —Å–∫—Ä–æ–ª–ª */
            position: relative;
        }
        
        /* –°—Ç–∏–ª–∏–∑–∞—Ü–∏—è —Å–∫—Ä–æ–ª–ª–±–∞—Ä–∞ */
        .table-container::-webkit-scrollbar { height: 8px; }
        .table-container::-webkit-scrollbar-track { background: rgba(0,0,0,0.2); }
        .table-container::-webkit-scrollbar-thumb { background: #475569; border-radius: 4px; }

        table {
            border-collapse: separate;
            border-spacing: 0;
            width: 100%;
        }

        th, td {
            padding: 12px;
            text-align: center;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            white-space: nowrap;
        }

        /* –ó–∞–∫—Ä–µ–ø–ª—è–µ–º –ø–µ—Ä–≤—É—é –∫–æ–ª–æ–Ω–∫—É (–ù–∞–∑–≤–∞–Ω–∏—è –ø—Ä–∏–≤—ã—á–µ–∫) */
        .sticky-col {
            position: sticky;
            left: 0;
            background: rgba(15, 23, 42, 0.95); /* –ù–µ–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ñ–æ–Ω, —á—Ç–æ–±—ã —Ç–µ–∫—Å—Ç –Ω–µ –Ω–∞–µ–∑–∂–∞–ª */
            z-index: 10;
            text-align: left;
            min-width: 200px;
            box-shadow: 2px 0 10px rgba(0,0,0,0.3);
            border-right: 1px solid rgba(255,255,255,0.1);
        }

        /* === –ß–ï–ö–ë–û–ö–°–´ === */
        .custom-checkbox {
            appearance: none;
            width: 20px;
            height: 20px;
            border: 2px solid #475569;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
            background: transparent;
        }

        .custom-checkbox:checked {
            background-color: #6366f1; /* Indigo-500 */
            border-color: #6366f1;
            box-shadow: 0 0 10px rgba(99, 102, 241, 0.5);
            background-image: url("data:image/svg+xml,%3csvg viewBox='0 0 16 16' fill='white' xmlns='http://www.w3.org/2000/svg'%3e%3cpath d='M12.207 4.793a1 1 0 010 1.414l-5 5a1 1 0 01-1.414 0l-2-2a1 1 0 011.414-1.414L6.5 9.086l4.293-4.293a1 1 0 011.414 0z'/%3e%3c/svg%3e");
        }

        .custom-checkbox:hover { border-color: #818cf8; }
    </style>
</head>
<body class="min-h-screen p-4 md:p-8">

    <!-- Header -->
    <header class="max-w-[1400px] mx-auto mb-6 flex flex-col md:flex-row justify-between items-center gap-4">
        <div>
            <h1 class="text-3xl font-bold bg-gradient-to-r from-indigo-400 to-cyan-400 bg-clip-text text-transparent">
                TREKER | –ü–†–ò–í–´–ß–ö–ò
            </h1>
            <p class="text-gray-400 text-sm mt-1" id="month-display">–ù–æ—è–±—Ä—å 2023</p>
        </div>
        
        <!-- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
        <div class="flex gap-3">
            <button onclick="addNewHabit()" class="glass px-4 py-2 rounded-lg hover:bg-white/10 transition text-sm flex items-center gap-2">
                <i class="fa-solid fa-plus text-indigo-400"></i> –î–æ–±–∞–≤–∏—Ç—å
            </button>
            <button onclick="resetData()" class="glass px-4 py-2 rounded-lg hover:bg-red-500/20 hover:text-red-400 transition text-sm text-gray-400">
                <i class="fa-solid fa-trash"></i> –°–±—Ä–æ—Å
            </button>
        </div>
    </header>

    <!-- GRID CONTAINER -->
    <main class="max-w-[1400px] mx-auto glass rounded-2xl overflow-hidden shadow-2xl mb-8">
        
        <div class="table-container">
            <table id="habit-table">
                <thead>
                    <tr class="bg-white/5 text-gray-400 text-xs uppercase tracking-wider">
                        <th class="sticky-col p-4">–ú–æ–∏ –ø—Ä–∏–≤—ã—á–∫–∏</th>
                        <!-- –î–Ω–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è JS -->
                        <th class="p-4 text-indigo-300 min-w-[100px]">–ò—Ç–æ–≥</th>
                    </tr>
                </thead>
                <tbody id="habit-body">
                    <!-- –°—Ç—Ä–æ–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è JS -->
                </tbody>
            </table>
        </div>

    </main>

    <!-- STATS / CHART (–ö–∞–∫ –≤ –≤–∏–¥–µ–æ –≤–Ω–∏–∑—É) -->
    <section class="max-w-[1400px] mx-auto grid grid-cols-1 lg:grid-cols-3 gap-6">
        
        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–µ–∫—Å—Ç–æ–º -->
        <div class="glass rounded-2xl p-6">
            <h3 class="text-gray-400 text-sm uppercase font-bold mb-4">–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</h3>
            <div class="flex items-end gap-2">
                <span id="total-percent" class="text-5xl font-bold text-indigo-400">0%</span>
                <span class="text-gray-500 mb-2">–æ–±—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å</span>
            </div>
            <div class="mt-4 w-full bg-gray-700 h-1 rounded-full overflow-hidden">
                <div id="global-progress-bar" class="h-full bg-indigo-500 w-0 transition-all duration-500"></div>
            </div>
        </div>

        <!-- –ì—Ä–∞—Ñ–∏–∫ (Chart.js) -->
        <div class="glass rounded-2xl p-4 lg:col-span-2 flex flex-col">
            <h3 class="text-gray-400 text-sm uppercase font-bold mb-2 pl-2">–î–∏–Ω–∞–º–∏–∫–∞ –ø–æ –¥–Ω—è–º</h3>
            <div class="flex-1 min-h-[200px]">
                <canvas id="activityChart"></canvas>
            </div>
        </div>
    </section>

    <!-- JAVASCRIPT -->
    <script>
        // === –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø ===
        const DAYS_IN_MONTH = 31; // –ú–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏, –Ω–æ –ø–æ–∫–∞ —Å—Ç–∞—Ç–∏–∫–∞ –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã
        const STORAGE_KEY = 'nexus_habits_v1';

        // –î–µ—Ñ–æ–ª—Ç–Ω—ã–µ –ø—Ä–∏–≤—ã—á–∫–∏ (–∫–∞–∫ –≤ –≤–∏–¥–µ–æ)
        const defaultHabits = [
            { id: 1, name: "üåÖ –ü—Ä–æ—Å–Ω—É—Ç—å—Å—è –≤ 5 —É—Ç—Ä–∞", checks: Array(DAYS_IN_MONTH).fill(false) },
            { id: 2, name: "üíß –°—Ç–∞–∫–∞–Ω –≤–æ–¥—ã", checks: Array(DAYS_IN_MONTH).fill(false) },
            { id: 3, name: "üìù –°–æ—Å—Ç–∞–≤–∏—Ç—å –ø–ª–∞–Ω –¥–Ω—è", checks: Array(DAYS_IN_MONTH).fill(false) },
            { id: 4, name: "üèãÔ∏è –° —É—Ç—Ä–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞", checks: Array(DAYS_IN_MONTH).fill(false) },
            { id: 5, name: "üìö –ß–∏—Ç–∞—Ç—å 15 –º–∏–Ω—É—Ç", checks: Array(DAYS_IN_MONTH).fill(false) },
            { id: 6, name: "üö´ –û—Ç–∫–∞–∑ –æ—Ç —Å–æ—Ü—Å–µ—Ç–µ–π", checks: Array(DAYS_IN_MONTH).fill(false) }
        ];

        let habits = JSON.parse(localStorage.getItem(STORAGE_KEY)) || defaultHabits;
        let chartInstance = null;

        // === –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ===
        function init() {
            // –î–∞—Ç–∞
            const now = new Date();
            const options = { month: 'long', year: 'numeric' };
            document.getElementById('month-display').textContent = now.toLocaleDateString('ru-RU', options).toUpperCase();

            renderTable();
            initChart();
            updateStats();
        }

        // === –û–¢–†–ò–°–û–í–ö–ê –¢–ê–ë–õ–ò–¶–´ ===
        function renderTable() {
            const thead = document.querySelector('#habit-table thead tr');
            const tbody = document.getElementById('habit-body');
            
            // –û—á–∏—â–∞–µ–º —Å—Ç–∞—Ä–æ–µ (–∫—Ä–æ–º–µ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤)
            // –°–±—Ä–æ—Å –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –¥–æ –±–∞–∑–æ–≤—ã—Ö (–ü—Ä–∏–≤—ã—á–∫–∞ + –ò—Ç–æ–≥)
            thead.innerHTML = '<th class="sticky-col p-4">–ú–æ–∏ –ø—Ä–∏–≤—ã—á–∫–∏</th>';
            
            // 1. –†–∏—Å—É–µ–º –∑–∞–≥–æ–ª–æ–≤–∫–∏ –¥–Ω–µ–π (1..31)
            for (let i = 1; i <= DAYS_IN_MONTH; i++) {
                const th = document.createElement('th');
                th.className = "text-gray-500 text-[10px] w-10";
                th.textContent = i;
                thead.appendChild(th);
            }
            // –î–æ–±–∞–≤–ª—è–µ–º "–ò—Ç–æ–≥" –≤ –∫–æ–Ω–µ—Ü
            const thResult = document.createElement('th');
            thResult.className = "p-4 text-indigo-300 min-w-[100px]";
            thResult.textContent = "–ü—Ä–æ–≥—Ä–µ—Å—Å";
            thead.appendChild(thResult);

            // 2. –†–∏—Å—É–µ–º —Å—Ç—Ä–æ–∫–∏ –ø—Ä–∏–≤—ã—á–µ–∫
            tbody.innerHTML = '';
            habits.forEach((habit, hIndex) => {
                const tr = document.createElement('tr');
                tr.className = "hover:bg-white/5 transition";

                // –ö–æ–ª–æ–Ω–∫–∞ –∏–º–µ–Ω–∏ (Sticky)
                const tdName = document.createElement('td');
                tdName.className = "sticky-col font-medium text-gray-300 border-r border-gray-700";
                tdName.innerHTML = `
                    <div class="flex justify-between items-center group">
                        <span>${habit.name}</span>
                        <button onclick="deleteHabit(${hIndex})" class="text-gray-600 hover:text-red-400 opacity-0 group-hover:opacity-100 transition text-xs"><i class="fa-solid fa-xmark"></i></button>
                    </div>
                `;
                tr.appendChild(tdName);

                // –ö–æ–ª–æ–Ω–∫–∏ –¥–Ω–µ–π (–ß–µ–∫–±–æ–∫—Å—ã)
                let completedCount = 0;
                
                habit.checks.forEach((isChecked, dIndex) => {
                    const td = document.createElement('td');
                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.className = 'custom-checkbox';
                    checkbox.checked = isChecked;
                    checkbox.onchange = () => toggleCheck(hIndex, dIndex);
                    
                    if(isChecked) completedCount++;
                    
                    td.appendChild(checkbox);
                    tr.appendChild(td);
                });

                // –ö–æ–ª–æ–Ω–∫–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ (–°–ø—Ä–∞–≤–∞)
                const percentage = Math.round((completedCount / DAYS_IN_MONTH) * 100);
                const tdProgress = document.createElement('td');
                tdProgress.innerHTML = `
                    <div class="flex items-center gap-2 justify-center">
                        <div class="w-16 h-2 bg-gray-700 rounded-full overflow-hidden">
                            <div class="h-full bg-indigo-500" style="width: ${percentage}%"></div>
                        </div>
                        <span class="text-xs font-mono w-8">${percentage}%</span>
                    </div>
                `;
                tr.appendChild(tdProgress);

                tbody.appendChild(tr);
            });
        }

        // === –õ–û–ì–ò–ö–ê ===
        function toggleCheck(hIndex, dIndex) {
            habits[hIndex].checks[dIndex] = !habits[hIndex].checks[dIndex];
            save();
            renderTable(); // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–∞ –Ω—É–∂–Ω–∞ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–æ–≤
            updateStats();
        }

        function addNewHabit() {
            const name = prompt("–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–∏–≤—ã—á–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä: –ú–µ–¥–∏—Ç–∞—Ü–∏—è):");
            if (name) {
                habits.push({
                    id: Date.now(),
                    name: name,
                    checks: Array(DAYS_IN_MONTH).fill(false)
                });
                save();
                renderTable();
                updateStats();
            }
        }

        function deleteHabit(index) {
            if(confirm("–£–¥–∞–ª–∏—Ç—å —ç—Ç—É –ø—Ä–∏–≤—ã—á–∫—É?")) {
                habits.splice(index, 1);
                save();
                renderTable();
                updateStats();
            }
        }

        function resetData() {
            if(confirm("–°–±—Ä–æ—Å–∏—Ç—å –≤–µ—Å—å –ø—Ä–æ–≥—Ä–µ—Å—Å?")) {
                habits.forEach(h => h.checks.fill(false));
                save();
                renderTable();
                updateStats();
            }
        }

        function save() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(habits));
        }

        // === –°–¢–ê–¢–ò–°–¢–ò–ö–ê –ò –ì–†–ê–§–ò–ö ===
        function updateStats() {
            // –û–±—â–∏–π –ø—Ä–æ—Ü–µ–Ω—Ç
            let totalChecks = 0;
            let totalPossible = habits.length * DAYS_IN_MONTH;
            
            // –î–∞–Ω–Ω—ã–µ –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞ (—Å—É–º–º–∞ –≥–∞–ª–æ—á–µ–∫ –ø–æ –¥–Ω—è–º)
            let dailyCounts = Array(DAYS_IN_MONTH).fill(0);

            habits.forEach(habit => {
                habit.checks.forEach((checked, index) => {
                    if(checked) {
                        totalChecks++;
                        dailyCounts[index]++;
                    }
                });
            });

            const globalPercent = totalPossible === 0 ? 0 : Math.round((totalChecks / totalPossible) * 100);
            document.getElementById('total-percent').textContent = `${globalPercent}%`;
            document.getElementById('global-progress-bar').style.width = `${globalPercent}%`;

            // –û–±–Ω–æ–≤–ª—è–µ–º –≥—Ä–∞—Ñ–∏–∫ Chart.js
            updateChart(dailyCounts);
        }

        function initChart() {
            const ctx = document.getElementById('activityChart').getContext('2d');
            
            // –ì—Ä–∞–¥–∏–µ–Ω—Ç –∫–∞–∫ –≤ –≤–∏–¥–µ–æ (—Å–∏–Ω–∏–π)
            const gradient = ctx.createLinearGradient(0, 0, 0, 400);
            gradient.addColorStop(0, 'rgba(99, 102, 241, 0.5)'); // Indigo
            gradient.addColorStop(1, 'rgba(99, 102, 241, 0.0)');

            chartInstance = new Chart(ctx, {
                type: 'line', // Line chart with fill = Area chart
                data: {
                    labels: Array.from({length: DAYS_IN_MONTH}, (_, i) => i + 1),
                    datasets: [{
                        label: '–í—ã–ø–æ–ª–Ω–µ–Ω–æ –ø—Ä–∏–≤—ã—á–µ–∫',
                        data: [],
                        borderColor: '#818cf8',
                        backgroundColor: gradient,
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4, // –ü–ª–∞–≤–Ω—ã–µ –ª–∏–Ω–∏–∏
                        pointRadius: 3,
                        pointBackgroundColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: { color: 'rgba(255, 255, 255, 0.05)' },
                            ticks: { color: '#94a3b8' }
                        },
                        x: {
                            grid: { display: false },
                            ticks: { color: '#94a3b8', maxTicksLimit: 10 }
                        }
                    }
                }
            });
        }

        function updateChart(dataArray) {
            if(chartInstance) {
                chartInstance.data.datasets[0].data = dataArray;
                chartInstance.update();
            }
        }

        // –ó–∞–ø—É—Å–∫
        init();
    </script>
</body>
</html>
